<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WAAPI å·¥å…·ç®±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: white;
            --bg-secondary: #f5f5f5;
            --bg-tertiary: #f8f9fa;
            --text-primary: #333;
            --text-secondary: #666;
            --text-tertiary: #999;
            --border-color: #ddd;
            --input-bg: white;
            --input-border: #ddd;
            --status-bg: #f5f5f5;
            --table-hover: #f5f5f5;
            --shadow: rgba(0,0,0,0.2);
            --primary-color: #667eea;
            --success-color: #4CAF50;
            --danger-color: #f44336;
            --warning-color: #ff9800;
            --body-gradient-start: #667eea;
            --body-gradient-end: #764ba2;
            --info-box-bg: #e3f2fd;
            --info-box-border: #2196F3;
        }

        [data-theme="dark"] {
            --bg-primary: #1e1e1e;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #252525;
            --text-primary: #e0e0e0;
            --text-secondary: #b0b0b0;
            --text-tertiary: #808080;
            --border-color: #404040;
            --input-bg: #2d2d2d;
            --input-border: #404040;
            --status-bg: #2d2d2d;
            --table-hover: #353535;
            --shadow: rgba(0,0,0,0.5);
            --body-gradient-start: #1a1a2e;
            --body-gradient-end: #16213e;
            --info-box-bg: #1e3a5f;
            --info-box-border: #4a90e2;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, var(--body-gradient-start) 0%, var(--body-gradient-end) 100%);
            padding: 20px;
            height: 100vh;
            overflow: hidden;
            transition: background 0.3s ease;
        }

        .container {
            background: var(--bg-primary);
            border-radius: 10px;
            padding: 30px;
            height: calc(100vh - 40px);
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 40px var(--shadow);
        }

        h1 {
            color: var(--text-primary);
            margin-bottom: 20px;
            text-align: center;
        }

        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }

        .input-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-group label {
            font-size: 14px;
            white-space: nowrap;
            color: var(--text-secondary);
            font-weight: bold;
        }

        input[type="number"], input[type="text"] {
            padding: 8px 12px;
            border: 2px solid var(--input-border);
            border-radius: 5px;
            font-size: 14px;
            background: var(--input-bg);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        input[type="number"]:focus, input[type="text"]:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.connected {
            background: var(--success-color);
        }

        .status-indicator.disconnected {
            background: #ccc;
        }

        .status-text {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .tabs {
            display: flex;
            gap: 10px;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            color: var(--text-secondary);
            transition: all 0.3s;
        }

        .tab:hover {
            color: var(--primary-color);
        }

        .tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .tab-content {
            flex: 1;
            overflow: hidden;
            display: none;
            flex-direction: column;
        }

        .tab-content.active {
            display: flex;
        }

        .tool-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 15px;
        }

        .tool-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: #45a049;
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background: #da190b;
        }

        .btn-danger:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-primary);
        }

        input[type="radio"] {
            cursor: pointer;
        }

        .checkbox-group {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-primary);
        }

        input[type="checkbox"] {
            cursor: pointer;
        }

        .btn-locate {
            background: var(--primary-color);
            color: white;
            padding: 6px 8px;
            font-size: 14px;
            border-radius: 3px;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            transition: all 0.3s;
        }

        .btn-locate:hover {
            background: #5568d3;
            transform: scale(1.1);
        }

        .btn-locate svg {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }

        .path-display {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            background: var(--bg-secondary);
            border-radius: 5px;
            border: 1px solid var(--border-color);
        }

        .path-display span {
            flex: 1;
            font-size: 13px;
            color: var(--text-secondary);
            word-break: break-all;
        }

        .results-container {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border-color);
            border-radius: 5px;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
        }

        .results-header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .btn-clear {
            background: var(--warning-color);
            color: white;
            padding: 6px 12px;
            font-size: 12px;
        }

        .btn-clear:hover {
            background: #f57c00;
        }

        .btn-clear:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .results-title {
            font-size: 16px;
            font-weight: bold;
            color: var(--text-primary);
        }

        .results-count {
            background: var(--primary-color);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
        }

        .results-table {
            flex: 1;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: var(--primary-color);
            color: white;
            position: sticky;
            top: 0;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-primary);
        }

        th {
            font-weight: bold;
            color: white;
        }

        /* è¡¨æ ¼åˆ—å®½åº¦ä¼˜åŒ– - é¿å…æ ‡é¢˜æ¢è¡Œ */
        
        /* é‡ç½®éŸ³é‡æ¨å­è¡¨æ ¼ */
        #resetFadersThLocate { width: 60px; min-width: 60px; }
        #resetFadersThIndex { width: 60px; min-width: 60px; }
        #resetFadersThName { width: 200px; min-width: 150px; }
        #resetFadersThType { width: 80px; min-width: 80px; }
        #resetFadersThVolume { width: 80px; min-width: 80px; }
        #resetFadersThStatus { width: 80px; min-width: 80px; }
        
        /* åˆ é™¤æ— æ•ˆEventè¡¨æ ¼ */
        #deleteEventsThLocate { width: 60px; min-width: 60px; }
        #deleteEventsThIndex { width: 60px; min-width: 60px; }
        #deleteEventsThName { width: 180px; min-width: 150px; }
        #deleteEventsThReason { width: 200px; min-width: 180px; }
        #deleteEventsThGuid { width: auto; min-width: 200px; }
        
        /* æ— æ•ˆåŸå› åˆ—å†…å®¹å­—ä½“å°ä¸€äº›ï¼Œé¿å…æ¢è¡Œ */
        #deleteEventsBody td:nth-child(4) {
            font-size: 12px;
            white-space: nowrap;
        }
        
        /* è®¾ç½®æµæ’­æ”¾è¡¨æ ¼ */
        #setStreamingThLocate { width: 60px; min-width: 60px; }
        #setStreamingThIndex { width: 60px; min-width: 60px; }
        #setStreamingThName { width: 200px; min-width: 150px; }
        #setStreamingThDuration { width: 120px; min-width: 120px; white-space: nowrap; }
        #setStreamingThShouldSet { width: 90px; min-width: 90px; white-space: nowrap; }
        #setStreamingThStatus { width: 140px; min-width: 140px; white-space: nowrap; }
        
        /* åˆ é™¤æœªä½¿ç”¨WAVè¡¨æ ¼ */
        #removeWavsThIndex { width: 60px; min-width: 60px; }
        #removeWavsThPath { width: auto; min-width: 300px; }
        #removeWavsThSize { width: 100px; min-width: 100px; white-space: nowrap; }
        #removeWavsThMtime { width: 160px; min-width: 160px; white-space: nowrap; }
        
        /* æ‰€æœ‰è¡¨å¤´ä¸æ¢è¡Œ */
        th {
            white-space: nowrap;
        }

        tbody tr:hover {
            background: var(--table-hover);
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--text-tertiary);
        }

        .info-box {
            padding: 12px 15px;
            background: var(--info-box-bg);
            border-left: 4px solid var(--info-box-border);
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 13px;
            color: var(--text-primary);
        }

        .settings-controls {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-left: auto;
        }

        .theme-btn, .lang-btn {
            width: 36px;
            height: 36px;
            padding: 0;
            border: 2px solid var(--border-color);
            border-radius: 5px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-btn:hover, .lang-btn:hover {
            background: var(--bg-tertiary);
            border-color: var(--primary-color);
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ WAAPI å·¥å…·ç®±</h1>
        
        <div class="header-controls">
            <div class="input-group">
                <label>ç«¯å£:</label>
                <input type="number" id="portInput" value="8080" min="1" max="65535" style="width: 80px;">
            </div>
            <div class="status-indicator disconnected" id="statusIndicator"></div>
            <span class="status-text" id="statusText">æœªè¿æ¥</span>
            <div class="settings-controls">
                <button class="theme-btn" id="themeToggleBtn" title="åˆ‡æ¢ä¸»é¢˜">â˜€ï¸</button>
                <button class="lang-btn" id="langToggleBtn" title="åˆ‡æ¢è¯­è¨€">ä¸­</button>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" data-tab="reset-faders">é‡ç½®éŸ³é‡æ¨å­</button>
            <button class="tab" data-tab="delete-events">åˆ é™¤æ— æ•ˆEvent</button>
            <button class="tab" data-tab="set-streaming">è®¾ç½®æµæ’­æ”¾</button>
            <button class="tab" data-tab="remove-wavs">åˆ é™¤æœªä½¿ç”¨WAV</button>
        </div>

        <!-- é‡ç½®éŸ³é‡æ¨å­æ ‡ç­¾ -->
        <div class="tab-content active" id="reset-faders-tab">
            <div class="info-box">
                é‡ç½®é€‰ä¸­å¯¹è±¡çš„éŸ³é‡æ¨å­ã€‚å¯ä»¥é€‰æ‹©ä»…é‡ç½®é€‰ä¸­å¯¹è±¡æœ¬èº«ï¼Œæˆ–é‡ç½®é€‰ä¸­å¯¹è±¡åŠå…¶æ‰€æœ‰å­å¯¹è±¡ã€‚
            </div>
            <div class="tool-panel">
                <div class="tool-controls">
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" name="resetScope" value="selected" checked>
                            <span id="resetScopeSelected">ä»…é€‰ä¸­å¯¹è±¡</span>
                        </label>
                        <label>
                            <input type="checkbox" name="resetScope" value="children" checked>
                            <span id="resetScopeChildren">é€‰ä¸­å¯¹è±¡+å­å¯¹è±¡</span>
                        </label>
                    </div>
                    <button class="btn-primary" id="resetFadersScanBtn">å¼€å§‹æ£€æµ‹</button>
                    <button class="btn-success" id="resetFadersConfirmBtn" style="display: none;">ç¡®è®¤é‡ç½®</button>
                </div>
            </div>
            <div class="results-container">
                <div class="results-header">
                    <span class="results-title" id="resetFadersResultsTitle">æ£€æµ‹ç»“æœ</span>
                    <div class="results-header-actions">
                        <span class="results-count" id="resetFadersCount">0 ä¸ªå¯¹è±¡</span>
                        <span class="results-count" id="resetFadersNonZeroCount" style="margin-left: 10px; color: var(--warning-color, #ff9800); display: none;"></span>
                        <button class="btn-primary" id="resetFadersListViewBtn" style="display: none; padding: 6px 12px; font-size: 12px;">æ˜¾ç¤ºåˆ°List View</button>
                        <button class="btn-primary" id="resetFadersMultiEditorBtn" style="display: none; padding: 6px 12px; font-size: 12px;">æ˜¾ç¤ºåˆ°Multi Editor</button>
                        <button class="btn-clear" id="resetFadersClearBtn">æ¸…é™¤ç»“æœ</button>
                    </div>
                </div>
                <div id="resetFadersNonZeroList" style="display: none; margin-top: 10px; padding: 10px; background: var(--bg-secondary, #f5f5f5); border-radius: 4px; max-height: 200px; overflow-y: auto;">
                    <div style="font-weight: bold; margin-bottom: 8px; color: var(--warning-color, #ff9800);" id="resetFadersNonZeroListTitle">æœªå½’é›¶å¯¹è±¡ï¼š</div>
                    <div id="resetFadersNonZeroListContent"></div>
                </div>
                <div class="results-table">
                    <table>
                        <thead>
                            <tr>
                                <th id="resetFadersThLocate">å®šä½</th>
                                <th id="resetFadersThIndex">åºå·</th>
                                <th id="resetFadersThName">å¯¹è±¡åç§°</th>
                                <th id="resetFadersThType">ç±»å‹</th>
                                <th id="resetFadersThVolume">åŸéŸ³é‡</th>
                                <th id="resetFadersThStatus">çŠ¶æ€</th>
                            </tr>
                        </thead>
                        <tbody id="resetFadersBody">
                            <tr>
                                <td colspan="6" class="empty-state" id="resetFadersEmptyState">è¯·ç‚¹å‡»"å¼€å§‹æ£€æµ‹"æŒ‰é’®</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- åˆ é™¤æ— æ•ˆEventæ ‡ç­¾ -->
        <div class="tab-content" id="delete-events-tab">
            <div class="info-box" id="deleteEventsInfoBox">
                æ‰«æå·¥ç¨‹ä¸­æ‰€æœ‰Eventï¼Œæ‰¾å‡ºæ‰€æœ‰Actionéƒ½å¼•ç”¨ä¸å­˜åœ¨å¯¹è±¡çš„æ— æ•ˆEventã€‚
            </div>
            <div class="tool-panel">
                <div class="tool-controls">
                    <button class="btn-primary" id="deleteEventsScanBtn">æ‰«ææ— æ•ˆEvent</button>
                    <button class="btn-danger" id="deleteEventsConfirmBtn" style="display: none;">ç¡®è®¤åˆ é™¤</button>
                </div>
            </div>
            <div class="results-container">
                <div class="results-header">
                    <span class="results-title" id="deleteEventsResultsTitle">æ‰«æç»“æœ</span>
                    <div class="results-header-actions">
                        <span class="results-count" id="deleteEventsCount">0 ä¸ªEvent</span>
                        <button class="btn-primary" id="deleteEventsListViewBtn" style="display: none; padding: 6px 12px; font-size: 12px;">æ˜¾ç¤ºåˆ°List View</button>
                        <button class="btn-primary" id="deleteEventsMultiEditorBtn" style="display: none; padding: 6px 12px; font-size: 12px;">æ˜¾ç¤ºåˆ°Multi Editor</button>
                        <button class="btn-clear" id="deleteEventsClearBtn">æ¸…é™¤ç»“æœ</button>
                    </div>
                </div>
                <div class="results-table">
                    <table>
                        <thead>
                            <tr>
                                <th id="deleteEventsThLocate">å®šä½</th>
                                <th id="deleteEventsThIndex">åºå·</th>
                                <th id="deleteEventsThName">Eventåç§°</th>
                                <th id="deleteEventsThReason">æ— æ•ˆåŸå› </th>
                                <th id="deleteEventsThGuid">è·¯å¾„</th>
                            </tr>
                        </thead>
                        <tbody id="deleteEventsBody">
                            <tr>
                                <td colspan="5" class="empty-state" id="deleteEventsEmptyState">è¯·ç‚¹å‡»"æ‰«ææ— æ•ˆEvent"æŒ‰é’®</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- è®¾ç½®æµæ’­æ”¾æ ‡ç­¾ -->
        <div class="tab-content" id="set-streaming-tab">
            <div class="info-box" id="setStreamingInfoBox">
                æ£€æµ‹é€‰ä¸­å®¹å™¨ä¸‹çš„æ‰€æœ‰Soundå¯¹è±¡ï¼Œä¸ºæ—¶é•¿è¶…è¿‡é˜ˆå€¼çš„å¯¹è±¡è®¾ç½®æµæ’­æ”¾å±æ€§ã€‚
            </div>
            <div class="tool-panel">
                <div class="tool-controls">
                    <div class="input-group">
                        <label id="setStreamingThresholdLabel">æ—¶é•¿é˜ˆå€¼ï¼ˆç§’ï¼‰:</label>
                        <input type="number" id="streamingThreshold" value="10" min="0" step="0.1" style="width: 100px;">
                    </div>
                    <button class="btn-primary" id="setStreamingScanBtn">æ£€æµ‹é€‰ä¸­å®¹å™¨</button>
                    <button class="btn-success" id="setStreamingConfirmBtn" style="display: none;">ç¡®è®¤è®¾ç½®</button>
                </div>
            </div>
            <div class="results-container">
                <div class="results-header">
                    <span class="results-title" id="setStreamingResultsTitle">æ£€æµ‹ç»“æœ</span>
                    <div class="results-header-actions">
                        <span class="results-count" id="setStreamingCount">0 ä¸ªå¯¹è±¡</span>
                        <button class="btn-primary" id="setStreamingListViewBtn" style="display: none; padding: 6px 12px; font-size: 12px;">æ˜¾ç¤ºåˆ°List View</button>
                        <button class="btn-primary" id="setStreamingMultiEditorBtn" style="display: none; padding: 6px 12px; font-size: 12px;">æ˜¾ç¤ºåˆ°Multi Editor</button>
                        <button class="btn-clear" id="setStreamingClearBtn">æ¸…é™¤ç»“æœ</button>
                    </div>
                </div>
                <div class="results-table">
                    <table>
                        <thead>
                            <tr>
                                <th id="setStreamingThLocate">å®šä½</th>
                                <th id="setStreamingThIndex">åºå·</th>
                                <th id="setStreamingThName">å¯¹è±¡åç§°</th>
                                <th id="setStreamingThDuration">å½“å‰æ—¶é•¿ï¼ˆç§’ï¼‰</th>
                                <th id="setStreamingThShouldSet">æ»¡è¶³æ¡ä»¶</th>
                                <th id="setStreamingThStatus">å½“å‰æµæ’­æ”¾çŠ¶æ€</th>
                            </tr>
                        </thead>
                        <tbody id="setStreamingBody">
                            <tr>
                                <td colspan="6" class="empty-state" id="setStreamingEmptyState">è¯·ç‚¹å‡»"æ£€æµ‹é€‰ä¸­å®¹å™¨"æŒ‰é’®</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- åˆ é™¤æœªä½¿ç”¨WAVæ ‡ç­¾ -->
        <div class="tab-content" id="remove-wavs-tab">
            <div class="info-box" id="removeWavsInfoBox">
                æ‰«æOriginalsæ–‡ä»¶å¤¹ï¼Œæ‰¾å‡ºæœªè¢«ä»»ä½•Soundå¯¹è±¡å¼•ç”¨çš„WAVæ–‡ä»¶ã€‚
            </div>
            <div class="tool-panel">
                <div class="tool-controls">
                    <div class="path-display">
                        <span id="originalsPath">æœªé€‰æ‹©æ–‡ä»¶å¤¹</span>
                        <button class="btn-primary" id="selectOriginalsBtn" style="padding: 6px 12px; font-size: 12px;">é€‰æ‹©æ–‡ä»¶å¤¹</button>
                    </div>
                    <button class="btn-primary" id="removeWavsScanBtn">æ‰«ææœªä½¿ç”¨æ–‡ä»¶</button>
                    <button class="btn-danger" id="removeWavsConfirmBtn" style="display: none;">ç¡®è®¤åˆ é™¤</button>
                </div>
            </div>
            <div class="results-container">
                <div class="results-header">
                    <span class="results-title" id="removeWavsResultsTitle">æ‰«æç»“æœ</span>
                    <div class="results-header-actions">
                        <span class="results-count" id="removeWavsCount">0 ä¸ªæ–‡ä»¶</span>
                        <button class="btn-clear" id="removeWavsClearBtn">æ¸…é™¤ç»“æœ</button>
                    </div>
                </div>
                <div class="results-table">
                    <table>
                        <thead>
                            <tr>
                                <th id="removeWavsThIndex">åºå·</th>
                                <th id="removeWavsThPath">æ–‡ä»¶è·¯å¾„</th>
                                <th id="removeWavsThSize">æ–‡ä»¶å¤§å°</th>
                                <th id="removeWavsThMtime">æœ€åä¿®æ”¹æ—¶é—´</th>
                            </tr>
                        </thead>
                        <tbody id="removeWavsBody">
                            <tr>
                                <td colspan="4" class="empty-state" id="removeWavsEmptyState">è¯·ç‚¹å‡»"æ‰«ææœªä½¿ç”¨æ–‡ä»¶"æŒ‰é’®</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="i18n.js"></script>
    <script>
        const { ipcRenderer } = require('electron');
        
        // ä¸»é¢˜å’Œè¯­è¨€ç®¡ç†
        let currentTheme = localStorage.getItem('theme') || 'light';
        let currentLanguage = localStorage.getItem('language') || 'zh';
        
        // æ›´æ–°æ‰€æœ‰æ–‡æœ¬çš„å›½é™…åŒ–
        function updateAllTexts() {
            if (typeof t !== 'function') return;
            
            // æ›´æ–°æ ‡é¢˜
            const titleEl = document.querySelector('h1');
            if (titleEl) titleEl.textContent = t('title');
            document.title = t('title');
            
            // æ›´æ–°ç«¯å£æ ‡ç­¾
            const portLabel = document.querySelector('.input-group label');
            if (portLabel) portLabel.textContent = t('port') + ':';
            
            // æ›´æ–°æ ‡ç­¾é¡µ
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach((tab, index) => {
                const tabKeys = ['tabs.resetFaders', 'tabs.deleteEvents', 'tabs.setStreaming', 'tabs.removeWavs'];
                if (tabKeys[index]) {
                    tab.textContent = t(tabKeys[index]);
                }
            });
            
            // æ›´æ–°çŠ¶æ€æ–‡æœ¬
            updateStatusText();
            
            // æ›´æ–°å„ä¸ªåŠŸèƒ½æ¨¡å—çš„æ–‡æœ¬
            updateResetFadersTexts();
            updateDeleteEventsTexts();
            updateSetStreamingTexts();
            updateRemoveWavsTexts();
        }
        
        // æ›´æ–°çŠ¶æ€æ–‡æœ¬
        function updateStatusText() {
            if (typeof t !== 'function') return;
            updateConnectionStatus();
        }
        
        // æ›´æ–°é‡ç½®éŸ³é‡æ¨å­ç›¸å…³æ–‡æœ¬
        function updateResetFadersTexts() {
            if (typeof t !== 'function') return;
            const infoBox = document.querySelector('#reset-faders-tab .info-box');
            if (infoBox) infoBox.textContent = t('resetFaders.info');
            
            const scopeSelected = document.getElementById('resetScopeSelected');
            if (scopeSelected) scopeSelected.textContent = t('resetFaders.scopeSelected');
            
            const scopeChildren = document.getElementById('resetScopeChildren');
            if (scopeChildren) scopeChildren.textContent = t('resetFaders.scopeChildren');
            
            const scanBtn = document.getElementById('resetFadersScanBtn');
            if (scanBtn && !scanBtn.disabled && !scanBtn.textContent.includes('...')) scanBtn.textContent = t('resetFaders.scanBtn');
            
            const confirmBtn = document.getElementById('resetFadersConfirmBtn');
            if (confirmBtn && !confirmBtn.disabled && !confirmBtn.textContent.includes('...')) confirmBtn.textContent = t('resetFaders.confirmBtn');
            
            const resultsTitle = document.getElementById('resetFadersResultsTitle');
            if (resultsTitle) resultsTitle.textContent = t('resetFaders.resultsTitle');
            
            const clearBtn = document.getElementById('resetFadersClearBtn');
            if (clearBtn) clearBtn.textContent = t('resetFaders.clearBtn');
            
            const listViewBtn = document.getElementById('resetFadersListViewBtn');
            if (listViewBtn && !listViewBtn.disabled && !listViewBtn.textContent.includes('...')) {
                listViewBtn.textContent = t('resetFaders.listViewBtn');
            }
            
            // æ›´æ–°è¡¨æ ¼è¡¨å¤´
            const thLocate = document.getElementById('resetFadersThLocate');
            if (thLocate) thLocate.textContent = t('resetFaders.tableHeaders.locate');
            const thIndex = document.getElementById('resetFadersThIndex');
            if (thIndex) thIndex.textContent = t('resetFaders.tableHeaders.index');
            const thName = document.getElementById('resetFadersThName');
            if (thName) thName.textContent = t('resetFaders.tableHeaders.name');
            const thType = document.getElementById('resetFadersThType');
            if (thType) thType.textContent = t('resetFaders.tableHeaders.type');
            const thVolume = document.getElementById('resetFadersThVolume');
            if (thVolume) thVolume.textContent = t('resetFaders.tableHeaders.volume');
            const thStatus = document.getElementById('resetFadersThStatus');
            if (thStatus) thStatus.textContent = t('resetFaders.tableHeaders.status');
            
            // æ›´æ–°ç©ºçŠ¶æ€æ–‡æœ¬
            const emptyState = document.getElementById('resetFadersEmptyState');
            if (emptyState && resetFadersResults && resetFadersResults.length === 0) {
                emptyState.textContent = t('resetFaders.emptyState');
            }
        }
        
        // æ›´æ–°åˆ é™¤æ— æ•ˆEventç›¸å…³æ–‡æœ¬
        function updateDeleteEventsTexts() {
            if (typeof t !== 'function') return;
            const infoBox = document.getElementById('deleteEventsInfoBox');
            if (infoBox) infoBox.textContent = t('deleteEvents.info');
            
            const scanBtn = document.getElementById('deleteEventsScanBtn');
            if (scanBtn && !scanBtn.disabled && !scanBtn.textContent.includes('...')) scanBtn.textContent = t('deleteEvents.scanBtn');
            
            const confirmBtn = document.getElementById('deleteEventsConfirmBtn');
            if (confirmBtn && !confirmBtn.disabled && !confirmBtn.textContent.includes('...')) confirmBtn.textContent = t('deleteEvents.confirmBtn');
            
            const resultsTitle = document.getElementById('deleteEventsResultsTitle');
            if (resultsTitle) resultsTitle.textContent = t('deleteEvents.resultsTitle');
            
            const clearBtn = document.getElementById('deleteEventsClearBtn');
            if (clearBtn) clearBtn.textContent = t('deleteEvents.clearBtn');
            
            // æ›´æ–°è¡¨æ ¼è¡¨å¤´
            const thIndex = document.getElementById('deleteEventsThIndex');
            if (thIndex) thIndex.textContent = t('deleteEvents.tableHeaders.index');
            const thName = document.getElementById('deleteEventsThName');
            if (thName) thName.textContent = t('deleteEvents.tableHeaders.name');
            const thLocate = document.getElementById('deleteEventsThLocate');
            if (thLocate) thLocate.textContent = t('deleteEvents.tableHeaders.locate');
            const thGuid = document.getElementById('deleteEventsThGuid');
            if (thGuid) thGuid.textContent = t('deleteEvents.tableHeaders.guid');
            const thReason = document.getElementById('deleteEventsThReason');
            if (thReason) thReason.textContent = t('deleteEvents.tableHeaders.reason');
            
            const listViewBtn = document.getElementById('deleteEventsListViewBtn');
            if (listViewBtn && !listViewBtn.disabled && !listViewBtn.textContent.includes('...')) {
                listViewBtn.textContent = t('deleteEvents.listViewBtn');
            }
            
            // æ›´æ–°ç©ºçŠ¶æ€æ–‡æœ¬
            const emptyState = document.getElementById('deleteEventsEmptyState');
            if (emptyState && deleteEventsResults && deleteEventsResults.length === 0) {
                emptyState.textContent = t('deleteEvents.emptyState');
            }
        }
        
        // æ›´æ–°è®¾ç½®æµæ’­æ”¾ç›¸å…³æ–‡æœ¬
        function updateSetStreamingTexts() {
            if (typeof t !== 'function') return;
            const infoBox = document.getElementById('setStreamingInfoBox');
            if (infoBox) infoBox.textContent = t('setStreaming.info');
            
            const thresholdLabel = document.getElementById('setStreamingThresholdLabel');
            if (thresholdLabel) thresholdLabel.textContent = t('setStreaming.thresholdLabel');
            
            const scanBtn = document.getElementById('setStreamingScanBtn');
            if (scanBtn && !scanBtn.disabled && !scanBtn.textContent.includes('...')) scanBtn.textContent = t('setStreaming.scanBtn');
            
            const confirmBtn = document.getElementById('setStreamingConfirmBtn');
            if (confirmBtn && !confirmBtn.disabled && !confirmBtn.textContent.includes('...')) confirmBtn.textContent = t('setStreaming.confirmBtn');
            
            const resultsTitle = document.getElementById('setStreamingResultsTitle');
            if (resultsTitle) resultsTitle.textContent = t('setStreaming.resultsTitle');
            
            const clearBtn = document.getElementById('setStreamingClearBtn');
            if (clearBtn) clearBtn.textContent = t('setStreaming.clearBtn');
            
            // æ›´æ–°è¡¨æ ¼è¡¨å¤´
            const thIndex = document.getElementById('setStreamingThIndex');
            if (thIndex) thIndex.textContent = t('setStreaming.tableHeaders.index');
            const thName = document.getElementById('setStreamingThName');
            if (thName) thName.textContent = t('setStreaming.tableHeaders.name');
            const thDuration = document.getElementById('setStreamingThDuration');
            if (thDuration) thDuration.textContent = t('setStreaming.tableHeaders.duration');
            const thShouldSet = document.getElementById('setStreamingThShouldSet');
            if (thShouldSet) thShouldSet.textContent = t('setStreaming.tableHeaders.shouldSet');
            const thStatus = document.getElementById('setStreamingThStatus');
            if (thStatus) thStatus.textContent = t('setStreaming.tableHeaders.currentStatus');
            const thLocate = document.getElementById('setStreamingThLocate');
            if (thLocate) thLocate.textContent = t('setStreaming.tableHeaders.locate');
            
            const listViewBtn = document.getElementById('setStreamingListViewBtn');
            if (listViewBtn && !listViewBtn.disabled && !listViewBtn.textContent.includes('...')) {
                listViewBtn.textContent = t('setStreaming.listViewBtn');
            }
            
            const multiEditorBtn = document.getElementById('setStreamingMultiEditorBtn');
            if (multiEditorBtn && !multiEditorBtn.disabled && !multiEditorBtn.textContent.includes('...')) {
                multiEditorBtn.textContent = t('setStreaming.multiEditorBtn');
            }
            
            // æ›´æ–°ç©ºçŠ¶æ€æ–‡æœ¬
            const emptyState = document.getElementById('setStreamingEmptyState');
            if (emptyState && setStreamingResults && setStreamingResults.length === 0) {
                emptyState.textContent = t('setStreaming.emptyState');
            }
        }
        
        // æ›´æ–°åˆ é™¤æœªä½¿ç”¨WAVç›¸å…³æ–‡æœ¬
        function updateRemoveWavsTexts() {
            if (typeof t !== 'function') return;
            const infoBox = document.getElementById('removeWavsInfoBox');
            if (infoBox) infoBox.textContent = t('removeWavs.info');
            
            const selectBtn = document.getElementById('selectOriginalsBtn');
            if (selectBtn) selectBtn.textContent = t('removeWavs.selectBtn');
            
            const scanBtn = document.getElementById('removeWavsScanBtn');
            if (scanBtn && !scanBtn.disabled && !scanBtn.textContent.includes('...')) scanBtn.textContent = t('removeWavs.scanBtn');
            
            const confirmBtn = document.getElementById('removeWavsConfirmBtn');
            if (confirmBtn && !confirmBtn.disabled && !confirmBtn.textContent.includes('...')) confirmBtn.textContent = t('removeWavs.confirmBtn');
            
            const resultsTitle = document.getElementById('removeWavsResultsTitle');
            if (resultsTitle) resultsTitle.textContent = t('removeWavs.resultsTitle');
            
            const clearBtn = document.getElementById('removeWavsClearBtn');
            if (clearBtn) clearBtn.textContent = t('removeWavs.clearBtn');
            
            const pathDisplay = document.getElementById('originalsPath');
            if (pathDisplay && !originalsPath) {
                pathDisplay.textContent = t('removeWavs.pathPlaceholder');
            }
            
            // æ›´æ–°è¡¨æ ¼è¡¨å¤´
            const thIndex = document.getElementById('removeWavsThIndex');
            if (thIndex) thIndex.textContent = t('removeWavs.tableHeaders.index');
            const thPath = document.getElementById('removeWavsThPath');
            if (thPath) thPath.textContent = t('removeWavs.tableHeaders.path');
            const thSize = document.getElementById('removeWavsThSize');
            if (thSize) thSize.textContent = t('removeWavs.tableHeaders.size');
            const thMtime = document.getElementById('removeWavsThMtime');
            if (thMtime) thMtime.textContent = t('removeWavs.tableHeaders.mtime');
            
            // æ›´æ–°ç©ºçŠ¶æ€æ–‡æœ¬
            const emptyState = document.getElementById('removeWavsEmptyState');
            if (emptyState && removeWavsResults && removeWavsResults.length === 0) {
                emptyState.textContent = t('removeWavs.emptyState');
            }
        }
        
        // åˆå§‹åŒ–ä¸»é¢˜
        function initTheme() {
            document.documentElement.setAttribute('data-theme', currentTheme);
            const themeBtn = document.getElementById('themeToggleBtn');
            if (themeBtn) {
                themeBtn.textContent = currentTheme === 'light' ? 'â˜€ï¸' : 'ğŸŒ™';
            }
        }
        
        // åˆå§‹åŒ–è¯­è¨€
        function initLanguage() {
            if (typeof setLanguage === 'function') {
                setLanguage(currentLanguage);
            }
            const langBtn = document.getElementById('langToggleBtn');
            if (langBtn) {
                langBtn.textContent = currentLanguage === 'zh' ? 'ä¸­' : 'E';
            }
            updateAllTexts();
        }
        
        // åˆå§‹åŒ–æŒ‰é’®äº‹ä»¶ç›‘å¬å™¨
        function initButtons() {
            const themeBtn = document.getElementById('themeToggleBtn');
            const langBtn = document.getElementById('langToggleBtn');
            
            if (themeBtn) {
                themeBtn.addEventListener('click', () => {
                    currentTheme = currentTheme === 'light' ? 'dark' : 'light';
                    localStorage.setItem('theme', currentTheme);
                    initTheme();
                });
            }
            
            if (langBtn) {
                langBtn.addEventListener('click', () => {
                    currentLanguage = currentLanguage === 'zh' ? 'en' : 'zh';
                    localStorage.setItem('language', currentLanguage);
                    initLanguage();
                });
            }
        }
        
        // ç­‰å¾…DOMåŠ è½½å®Œæˆåå†åˆå§‹åŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                initTheme();
                initLanguage();
                initButtons();
            });
        } else {
            initTheme();
            initLanguage();
            initButtons();
        }

        // æ ‡ç­¾é¡µåˆ‡æ¢
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const targetTab = tab.getAttribute('data-tab');
                
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(targetTab + '-tab').classList.add('active');
            });
        });

        // è¿æ¥çŠ¶æ€
        let isConnected = false;
        let currentProjectName = '';
        let currentWwiseVersion = '';
        const portInput = document.getElementById('portInput');
        const statusIndicator = document.getElementById('statusIndicator');
        const statusText = document.getElementById('statusText');

        // æµ‹è¯•è¿æ¥
        async function testConnection() {
            const port = parseInt(portInput.value) || 8080;
            try {
                const result = await ipcRenderer.invoke('waapi-test-connection', port);
                if (result.success) {
                    isConnected = true;
                    currentProjectName = result.projectName || 'Wwise';
                    currentWwiseVersion = result.wwiseVersion || '';
                    statusIndicator.className = 'status-indicator connected';
                    updateConnectionStatus();
                } else {
                    isConnected = false;
                    currentProjectName = '';
                    currentWwiseVersion = '';
                    statusIndicator.className = 'status-indicator disconnected';
                    statusText.textContent = typeof t === 'function' ? t('disconnected') : 'æœªè¿æ¥';
                }
            } catch (error) {
                isConnected = false;
                currentProjectName = '';
                currentWwiseVersion = '';
                statusIndicator.className = 'status-indicator disconnected';
                statusText.textContent = typeof t === 'function' ? t('disconnected') : 'æœªè¿æ¥';
            }
        }

        // æ›´æ–°è¿æ¥çŠ¶æ€æ˜¾ç¤º
        function updateConnectionStatus() {
            if (isConnected) {
                const connectedText = typeof t === 'function' ? t('connected') : 'å·²è¿æ¥';
                if (currentWwiseVersion) {
                    statusText.textContent = `${connectedText} - ${currentProjectName} (${currentWwiseVersion})`;
                } else {
                    statusText.textContent = `${connectedText} - ${currentProjectName}`;
                }
            } else {
                statusText.textContent = typeof t === 'function' ? t('disconnected') : 'æœªè¿æ¥';
            }
        }

        // é¡µé¢åŠ è½½æ—¶æµ‹è¯•è¿æ¥
        testConnection();
        portInput.addEventListener('change', testConnection);

        // é‡ç½®éŸ³é‡æ¨å­åŠŸèƒ½
        let resetFadersResults = [];
        const resetFadersScanBtn = document.getElementById('resetFadersScanBtn');
        const resetFadersConfirmBtn = document.getElementById('resetFadersConfirmBtn');
        const resetFadersClearBtn = document.getElementById('resetFadersClearBtn');
        const resetFadersBody = document.getElementById('resetFadersBody');
        const resetFadersCount = document.getElementById('resetFadersCount');

        resetFadersScanBtn.addEventListener('click', async () => {
            if (!isConnected) {
                alert(typeof t === 'function' ? t('resetFaders.alertNotConnected') : 'è¯·å…ˆè¿æ¥åˆ°Wwise');
                return;
            }
            const port = parseInt(portInput.value) || 8080;
            const checkedScopes = Array.from(document.querySelectorAll('input[name="resetScope"]:checked')).map(cb => cb.value);
            if (checkedScopes.length === 0) {
                alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªé€‰é¡¹');
                return;
            }
            const scope = checkedScopes;
            
            resetFadersScanBtn.disabled = true;
            resetFadersScanBtn.textContent = typeof t === 'function' ? t('resetFaders.scanBtnScanning') : 'æ£€æµ‹ä¸­...';
            
            try {
                const result = await ipcRenderer.invoke('waapi-reset-faders-scan', port, scope);
                resetFadersResults = result.results || [];
                updateResetFadersTable();
                
                // æ˜¾ç¤ºæ£€æµ‹ç»“æœæç¤º
                const countText = typeof t === 'function' ? t('resetFaders.resultsCount') : 'ä¸ªå¯¹è±¡';
                alert((typeof t === 'function' ? t('resetFaders.scanSuccess') : 'æ£€æµ‹å®Œæˆ') + `ï¼šæ‰¾åˆ° ${resetFadersResults.length} ${countText}`);
                
                // æ£€æŸ¥æ˜¯å¦æœ‰æœªå½’é›¶å¯¹è±¡
                const hasNonZero = resetFadersResults.some(item => {
                    const status = item.status || '';
                    if (status === 'å·²å½’é›¶') return false;
                    return item.originalVolume !== null && item.originalVolume !== undefined && item.originalVolume !== 0;
                });
                if (hasNonZero) {
                    resetFadersConfirmBtn.style.display = 'inline-block';
                } else {
                    resetFadersConfirmBtn.style.display = 'none';
                }
            } catch (error) {
                alert((typeof t === 'function' ? t('resetFaders.alertScanFailed') : 'æ£€æµ‹å¤±è´¥') + ': ' + error.message);
            } finally {
                resetFadersScanBtn.disabled = false;
                resetFadersScanBtn.textContent = typeof t === 'function' ? t('resetFaders.scanBtn') : 'å¼€å§‹æ£€æµ‹';
            }
        });

        resetFadersConfirmBtn.addEventListener('click', async () => {
            if (resetFadersResults.length === 0) return;
            
            // è·å–æœªå½’é›¶å¯¹è±¡
            const nonZeroObjects = resetFadersResults.filter(item => {
                const status = item.status || '';
                if (status === 'å·²å½’é›¶') {
                    return false;
                }
                return item.originalVolume !== null && item.originalVolume !== undefined && item.originalVolume !== 0;
            });
            
            if (nonZeroObjects.length === 0) {
                alert(typeof t === 'function' ? t('resetFaders.allZeroed') : 'æ‰€æœ‰å¯¹è±¡å·²å½’é›¶ï¼Œæ— éœ€é‡ç½®');
                return;
            }
            
            const confirmed = await ipcRenderer.invoke('waapi-show-confirm', {
                type: 'warning',
                title: typeof t === 'function' ? t('resetFaders.confirmTitle') : 'ç¡®è®¤é‡ç½®',
                message: typeof t === 'function' ? t('resetFaders.confirmMessage', { count: nonZeroObjects.length }) : `ç¡®å®šè¦é‡ç½® ${nonZeroObjects.length} ä¸ªå¯¹è±¡çš„éŸ³é‡æ¨å­å—ï¼Ÿ`,
                buttons: typeof t === 'function' ? [t('common.cancel'), t('resetFaders.confirmBtn')] : ['å–æ¶ˆ', 'ç¡®è®¤é‡ç½®'],
                defaultId: 1
            });
            
            if (confirmed.response === 1) {
                const port = parseInt(portInput.value) || 8080;
                const checkedScopes = Array.from(document.querySelectorAll('input[name="resetScope"]:checked')).map(cb => cb.value);
                const scope = checkedScopes;
                
                resetFadersConfirmBtn.disabled = true;
                resetFadersConfirmBtn.textContent = typeof t === 'function' ? t('resetFaders.confirmBtnResetting') : 'é‡ç½®ä¸­...';
                
                try {
                    // åªä¼ é€’æœªå½’é›¶å¯¹è±¡è¿›è¡Œé‡ç½®
                    const result = await ipcRenderer.invoke('waapi-reset-faders-execute', port, scope, nonZeroObjects);
                    if (result.success) {
                        // æ›´æ–°æˆåŠŸé‡ç½®çš„å¯¹è±¡çŠ¶æ€ä¸º"å·²é‡ç½®"
                        if (result.resetIds && result.resetIds.length > 0) {
                            const resetIdsSet = new Set(result.resetIds);
                            resetFadersResults.forEach(item => {
                                if (resetIdsSet.has(item.id)) {
                                    item.status = 'å·²é‡ç½®';
                                }
                            });
                        }
                        updateResetFadersTable();
                        alert(typeof t === 'function' ? t('resetFaders.successMessage', { count: result.count }) : `æˆåŠŸé‡ç½® ${result.count} ä¸ªå¯¹è±¡çš„éŸ³é‡æ¨å­`);
                        // æ£€æŸ¥æ˜¯å¦è¿˜æœ‰å¾…é‡ç½®çš„å¯¹è±¡
                        const hasPending = resetFadersResults.some(item => {
                            const status = item.status || '';
                            if (status === 'å·²å½’é›¶') return false;
                            return item.originalVolume !== null && item.originalVolume !== undefined && item.originalVolume !== 0;
                        });
                        if (!hasPending) {
                            resetFadersConfirmBtn.style.display = 'none';
                        }
                    } else {
                        alert((typeof t === 'function' ? t('resetFaders.alertResetFailed') : 'é‡ç½®å¤±è´¥') + ': ' + result.message);
                    }
                } catch (error) {
                    alert((typeof t === 'function' ? t('resetFaders.alertResetFailed') : 'é‡ç½®å¤±è´¥') + ': ' + error.message);
                } finally {
                    resetFadersConfirmBtn.disabled = false;
                    resetFadersConfirmBtn.textContent = typeof t === 'function' ? t('resetFaders.confirmBtn') : 'ç¡®è®¤é‡ç½®';
                }
            }
        });

        resetFadersClearBtn.addEventListener('click', () => {
            resetFadersResults = [];
            updateResetFadersTable();
            resetFadersConfirmBtn.style.display = 'none';
        });

        const resetFadersListViewBtn = document.getElementById('resetFadersListViewBtn');
        resetFadersListViewBtn.addEventListener('click', async () => {
            if (resetFadersResults.length === 0) return;
            if (!isConnected) {
                alert(typeof t === 'function' ? t('resetFaders.alertNotConnected') : 'è¯·å…ˆè¿æ¥åˆ°Wwise');
                return;
            }
            
            // è·å–æœªå½’é›¶å¯¹è±¡
            const nonZeroObjects = resetFadersResults.filter(item => {
                const status = item.status || '';
                if (status === 'å·²å½’é›¶') return false;
                return item.originalVolume !== null && item.originalVolume !== undefined && item.originalVolume !== 0;
            });
            
            if (nonZeroObjects.length === 0) {
                alert(typeof t === 'function' ? t('resetFaders.allZeroed') : 'æ‰€æœ‰å¯¹è±¡å·²å½’é›¶ï¼Œæ— éœ€é‡ç½®');
                return;
            }
            
            const port = parseInt(portInput.value) || 8080;
            resetFadersListViewBtn.disabled = true;
            resetFadersListViewBtn.textContent = typeof t === 'function' ? t('resetFaders.listViewBtnLoading') : 'æ˜¾ç¤ºä¸­...';
            
            try {
                // æå–æœªå½’é›¶å¯¹è±¡çš„ID
                const objectIds = nonZeroObjects
                    .map(r => r.id || r.guid)
                    .filter(id => id && typeof id === 'string');
                
                if (objectIds.length === 0) {
                    alert(typeof t === 'function' ? t('resetFaders.listViewNoObjects') : 'æ²¡æœ‰æœ‰æ•ˆçš„å¯¹è±¡ID');
                    return;
                }
                
                // æ˜¾ç¤ºåˆ°List View
                const result = await ipcRenderer.invoke('waapi-show-list-view', port, objectIds);
                
                if (result.success) {
                    // æˆåŠŸæç¤ºï¼ˆå¯é€‰ï¼‰
                    // alert(typeof t === 'function' ? t('resetFaders.listViewSuccess') : 'å·²æ˜¾ç¤ºåˆ°List View');
                } else {
                    alert((typeof t === 'function' ? t('resetFaders.listViewFailed') : 'æ˜¾ç¤ºåˆ°List Viewå¤±è´¥') + ': ' + result.message);
                }
            } catch (error) {
                alert((typeof t === 'function' ? t('resetFaders.listViewFailed') : 'æ˜¾ç¤ºåˆ°List Viewå¤±è´¥') + ': ' + error.message);
            } finally {
                resetFadersListViewBtn.disabled = false;
                resetFadersListViewBtn.textContent = typeof t === 'function' ? t('resetFaders.listViewBtn') : 'æ˜¾ç¤ºåˆ°List View';
            }
        });

        const resetFadersMultiEditorBtn = document.getElementById('resetFadersMultiEditorBtn');
        resetFadersMultiEditorBtn.addEventListener('click', async () => {
            if (resetFadersResults.length === 0) return;
            if (!isConnected) {
                alert(typeof t === 'function' ? t('resetFaders.alertNotConnected') : 'è¯·å…ˆè¿æ¥åˆ°Wwise');
                return;
            }
            
            // è·å–æœªå½’é›¶å¯¹è±¡
            const nonZeroObjects = resetFadersResults.filter(item => {
                const status = item.status || '';
                if (status === 'å·²å½’é›¶') return false;
                return item.originalVolume !== null && item.originalVolume !== undefined && item.originalVolume !== 0;
            });
            
            if (nonZeroObjects.length === 0) {
                alert(typeof t === 'function' ? t('resetFaders.allZeroed') : 'æ‰€æœ‰å¯¹è±¡å·²å½’é›¶ï¼Œæ— éœ€é‡ç½®');
                return;
            }
            
            const port = parseInt(portInput.value) || 8080;
            resetFadersMultiEditorBtn.disabled = true;
            resetFadersMultiEditorBtn.textContent = typeof t === 'function' ? t('resetFaders.multiEditorBtnLoading') : 'æ˜¾ç¤ºä¸­...';
            
            try {
                // æå–æœªå½’é›¶å¯¹è±¡çš„ID
                const objectIds = nonZeroObjects
                    .map(r => r.id || r.guid)
                    .filter(id => id && typeof id === 'string');
                
                if (objectIds.length === 0) {
                    alert(typeof t === 'function' ? t('resetFaders.multiEditorNoObjects') : 'æ²¡æœ‰æœ‰æ•ˆçš„å¯¹è±¡ID');
                    return;
                }
                
                // æ˜¾ç¤ºåˆ°Multi Editor
                const result = await ipcRenderer.invoke('waapi-show-multi-editor', port, objectIds);
                
                if (result.success) {
                    // æˆåŠŸæç¤ºï¼ˆå¯é€‰ï¼‰
                } else {
                    alert((typeof t === 'function' ? t('resetFaders.multiEditorFailed') : 'æ˜¾ç¤ºåˆ°Multi Editorå¤±è´¥') + ': ' + result.message);
                }
            } catch (error) {
                alert((typeof t === 'function' ? t('resetFaders.multiEditorFailed') : 'æ˜¾ç¤ºåˆ°Multi Editorå¤±è´¥') + ': ' + error.message);
            } finally {
                resetFadersMultiEditorBtn.disabled = false;
                resetFadersMultiEditorBtn.textContent = typeof t === 'function' ? t('resetFaders.multiEditorBtn') : 'æ˜¾ç¤ºåˆ°Multi Editor';
            }
        });

        // åœ¨è¡¨æ ¼æ›´æ–°åé‡æ–°åˆå§‹åŒ–åˆ—å®½è°ƒæ•´
        function updateResetFadersTable() {
            // ç»Ÿè®¡æœªå½’é›¶å¯¹è±¡ï¼ˆçŠ¶æ€ä¸º"å¾…é‡ç½®"æˆ–éŸ³é‡ä¸ä¸º0çš„å¯¹è±¡ï¼‰
            const nonZeroObjects = resetFadersResults.filter(item => {
                const status = item.status || '';
                // å¦‚æœçŠ¶æ€æ˜¯"å·²å½’é›¶"ï¼Œåˆ™ä¸æ˜¯æœªå½’é›¶å¯¹è±¡
                if (status === 'å·²å½’é›¶') {
                    return false;
                }
                // å…¶ä»–æƒ…å†µï¼ˆå¾…é‡ç½®ã€å·²é‡ç½®ç­‰ï¼‰æˆ–è€…éŸ³é‡ä¸ä¸º0çš„éƒ½æ˜¯æœªå½’é›¶å¯¹è±¡
                return item.originalVolume !== null && item.originalVolume !== undefined && item.originalVolume !== 0;
            });
            
            // åªæ˜¾ç¤ºæœªå½’é›¶å¯¹è±¡çš„æ•°é‡
            const countText = typeof t === 'function' ? t('resetFaders.resultsCount') : 'ä¸ªå¯¹è±¡';
            resetFadersCount.textContent = `${nonZeroObjects.length} ${countText}`;
            resetFadersClearBtn.disabled = resetFadersResults.length === 0;
            
            // éšè—æœªå½’é›¶å¯¹è±¡åˆ—è¡¨åŒºåŸŸï¼ˆå› ä¸ºè¡¨æ ¼å·²ç»æ˜¾ç¤ºäº†ï¼‰
            const nonZeroCount = document.getElementById('resetFadersNonZeroCount');
            const nonZeroList = document.getElementById('resetFadersNonZeroList');
            if (nonZeroCount) nonZeroCount.style.display = 'none';
            if (nonZeroList) nonZeroList.style.display = 'none';
            
            // åŸºäºæœªå½’é›¶å¯¹è±¡æ•°é‡æ˜¾ç¤ºæŒ‰é’®
            if (nonZeroObjects.length > 0) {
                resetFadersListViewBtn.style.display = 'inline-block';
                resetFadersMultiEditorBtn.style.display = 'inline-block';
            } else {
                resetFadersListViewBtn.style.display = 'none';
                resetFadersMultiEditorBtn.style.display = 'none';
            }
            
            // å¦‚æœæ²¡æœ‰æ£€æµ‹ç»“æœï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€
            if (resetFadersResults.length === 0) {
                const emptyText = typeof t === 'function' ? t('resetFaders.emptyState') : 'è¯·ç‚¹å‡»"å¼€å§‹æ£€æµ‹"æŒ‰é’®';
                resetFadersBody.innerHTML = `<tr><td colspan="6" class="empty-state" id="resetFadersEmptyState">${emptyText}</td></tr>`;
                return;
            }
            
            // å¦‚æœæ²¡æœ‰æœªå½’é›¶å¯¹è±¡ï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
            if (nonZeroObjects.length === 0) {
                const emptyText = typeof t === 'function' ? t('resetFaders.allZeroed') : 'æ‰€æœ‰å¯¹è±¡å·²å½’é›¶ï¼Œæ— éœ€é‡ç½®';
                resetFadersBody.innerHTML = `<tr><td colspan="6" class="empty-state" id="resetFadersEmptyState">${emptyText}</td></tr>`;
                return;
            }
            
            // åªæ˜¾ç¤ºæœªå½’é›¶å¯¹è±¡
            resetFadersBody.innerHTML = nonZeroObjects.map((item, index) => `
                <tr>
                    <td><button class="btn-locate" onclick="locateObject('${item.id}')" title="å®šä½"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg></button></td>
                    <td>${index + 1}</td>
                    <td>${item.name || 'N/A'}</td>
                    <td>${item.type || 'N/A'}</td>
                    <td>${item.originalVolume !== null && item.originalVolume !== undefined ? item.originalVolume.toFixed(2) : 'N/A'}</td>
                    <td>${item.status === 'å·²å½’é›¶' ? (typeof t === 'function' ? t('resetFaders.statusZeroed') : 'å·²å½’é›¶') : (item.status === 'å·²é‡ç½®' ? (typeof t === 'function' ? t('resetFaders.statusReset') : 'å·²é‡ç½®') + ' <span style="color: #4caf50;">âœ“</span>' : (item.status === 'å¾…é‡ç½®' ? (typeof t === 'function' ? t('resetFaders.statusPending') : 'å¾…é‡ç½®') : (item.status || (typeof t === 'function' ? t('resetFaders.statusPending') : 'å¾…é‡ç½®'))))}</td>
                </tr>
            `).join('');
        }

        // å®šä½å¯¹è±¡åˆ°Wwiseçª—å£
        async function locateObject(objectId) {
            if (!isConnected) {
                alert(typeof t === 'function' ? t('resetFaders.alertNotConnected') : 'è¯·å…ˆè¿æ¥åˆ°Wwise');
                return;
            }
            const port = parseInt(portInput.value) || 8080;
            try {
                await ipcRenderer.invoke('waapi-locate-object', port, objectId);
            } catch (error) {
                alert('å®šä½å¤±è´¥: ' + error.message);
            }
        }

        // åˆ é™¤æ— æ•ˆEventåŠŸèƒ½
        let deleteEventsResults = [];
        const deleteEventsScanBtn = document.getElementById('deleteEventsScanBtn');
        const deleteEventsConfirmBtn = document.getElementById('deleteEventsConfirmBtn');
        const deleteEventsClearBtn = document.getElementById('deleteEventsClearBtn');
        const deleteEventsBody = document.getElementById('deleteEventsBody');
        const deleteEventsCount = document.getElementById('deleteEventsCount');

        deleteEventsScanBtn.addEventListener('click', async () => {
            if (!isConnected) {
                alert(typeof t === 'function' ? t('deleteEvents.alertNotConnected') : 'è¯·å…ˆè¿æ¥åˆ°Wwise');
                return;
            }
            const port = parseInt(portInput.value) || 8080;
            
            deleteEventsScanBtn.disabled = true;
            deleteEventsScanBtn.textContent = typeof t === 'function' ? t('deleteEvents.scanBtnScanning') : 'æ‰«æä¸­...';
            
            try {
                const result = await ipcRenderer.invoke('waapi-delete-events-scan', port);
                deleteEventsResults = result.results || [];
                updateDeleteEventsTable();
                
                // æ˜¾ç¤ºæ£€æµ‹ç»“æœæç¤º
                const countText = typeof t === 'function' ? t('deleteEvents.resultsCount') : 'ä¸ªEvent';
                if (deleteEventsResults.length > 0) {
                    alert((typeof t === 'function' ? t('deleteEvents.scanSuccess') : 'æ‰«æå®Œæˆ') + `ï¼šæ‰¾åˆ° ${deleteEventsResults.length} ${countText}`);
                    deleteEventsConfirmBtn.style.display = 'inline-block';
                } else {
                    alert(typeof t === 'function' ? t('deleteEvents.scanNoResults') : 'æ‰«æå®Œæˆï¼šæœªæ‰¾åˆ°æ— æ•ˆEvent');
                }
            } catch (error) {
                alert((typeof t === 'function' ? t('deleteEvents.alertScanFailed') : 'æ‰«æå¤±è´¥') + ': ' + error.message);
            } finally {
                deleteEventsScanBtn.disabled = false;
                deleteEventsScanBtn.textContent = typeof t === 'function' ? t('deleteEvents.scanBtn') : 'æ‰«ææ— æ•ˆEvent';
            }
        });

        deleteEventsConfirmBtn.addEventListener('click', async () => {
            if (deleteEventsResults.length === 0) return;
            
            const confirmed = await ipcRenderer.invoke('waapi-show-confirm', {
                type: 'warning',
                title: typeof t === 'function' ? t('deleteEvents.confirmTitle') : 'ç¡®è®¤åˆ é™¤',
                message: typeof t === 'function' ? t('deleteEvents.confirmMessage', { count: deleteEventsResults.length }) : `ç¡®å®šè¦åˆ é™¤ ${deleteEventsResults.length} ä¸ªæ— æ•ˆEventå—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼`,
                buttons: typeof t === 'function' ? [t('common.cancel'), t('deleteEvents.confirmBtn')] : ['å–æ¶ˆ', 'ç¡®è®¤åˆ é™¤'],
                defaultId: 1
            });
            
            if (confirmed.response === 1) {
                const port = parseInt(portInput.value) || 8080;
                
                deleteEventsConfirmBtn.disabled = true;
                deleteEventsConfirmBtn.textContent = typeof t === 'function' ? t('deleteEvents.confirmBtnDeleting') : 'åˆ é™¤ä¸­...';
                
                try {
                    const result = await ipcRenderer.invoke('waapi-delete-events-execute', port, deleteEventsResults);
                    if (result.success) {
                        alert(typeof t === 'function' ? t('deleteEvents.successMessage', { count: result.count }) : `æˆåŠŸåˆ é™¤ ${result.count} ä¸ªæ— æ•ˆEvent`);
                        deleteEventsResults = [];
                        updateDeleteEventsTable();
                        deleteEventsConfirmBtn.style.display = 'none';
                    } else {
                        alert((typeof t === 'function' ? t('deleteEvents.alertDeleteFailed') : 'åˆ é™¤å¤±è´¥') + ': ' + result.message);
                    }
                } catch (error) {
                    alert((typeof t === 'function' ? t('deleteEvents.alertDeleteFailed') : 'åˆ é™¤å¤±è´¥') + ': ' + error.message);
                } finally {
                    deleteEventsConfirmBtn.disabled = false;
                    deleteEventsConfirmBtn.textContent = typeof t === 'function' ? t('deleteEvents.confirmBtn') : 'ç¡®è®¤åˆ é™¤';
                }
            }
        });

        deleteEventsClearBtn.addEventListener('click', () => {
            deleteEventsResults = [];
            updateDeleteEventsTable();
            deleteEventsConfirmBtn.style.display = 'none';
        });

        const deleteEventsListViewBtn = document.getElementById('deleteEventsListViewBtn');
        deleteEventsListViewBtn.addEventListener('click', async () => {
            if (deleteEventsResults.length === 0) return;
            if (!isConnected) {
                alert(typeof t === 'function' ? t('deleteEvents.alertNotConnected') : 'è¯·å…ˆè¿æ¥åˆ°Wwise');
                return;
            }
            
            const port = parseInt(portInput.value) || 8080;
            deleteEventsListViewBtn.disabled = true;
            deleteEventsListViewBtn.textContent = typeof t === 'function' ? t('deleteEvents.listViewBtnLoading') : 'æ˜¾ç¤ºä¸­...';
            
            try {
                // æå–æ‰€æœ‰å¯¹è±¡ID
                const objectIds = deleteEventsResults
                    .map(r => r.guid || r.id)
                    .filter(id => id && typeof id === 'string');
                
                if (objectIds.length === 0) {
                    alert(typeof t === 'function' ? t('deleteEvents.listViewNoObjects') : 'æ²¡æœ‰æœ‰æ•ˆçš„å¯¹è±¡ID');
                    return;
                }
                
                // æ˜¾ç¤ºåˆ°List View
                const result = await ipcRenderer.invoke('waapi-show-list-view', port, objectIds);
                
                if (result.success) {
                    // æˆåŠŸæç¤ºï¼ˆå¯é€‰ï¼‰
                } else {
                    alert((typeof t === 'function' ? t('deleteEvents.listViewFailed') : 'æ˜¾ç¤ºåˆ°List Viewå¤±è´¥') + ': ' + result.message);
                }
            } catch (error) {
                alert((typeof t === 'function' ? t('deleteEvents.listViewFailed') : 'æ˜¾ç¤ºåˆ°List Viewå¤±è´¥') + ': ' + error.message);
            } finally {
                deleteEventsListViewBtn.disabled = false;
                deleteEventsListViewBtn.textContent = typeof t === 'function' ? t('deleteEvents.listViewBtn') : 'æ˜¾ç¤ºåˆ°List View';
            }
        });

        const deleteEventsMultiEditorBtn = document.getElementById('deleteEventsMultiEditorBtn');
        deleteEventsMultiEditorBtn.addEventListener('click', async () => {
            if (deleteEventsResults.length === 0) return;
            if (!isConnected) {
                alert(typeof t === 'function' ? t('deleteEvents.alertNotConnected') : 'è¯·å…ˆè¿æ¥åˆ°Wwise');
                return;
            }
            
            const port = parseInt(portInput.value) || 8080;
            deleteEventsMultiEditorBtn.disabled = true;
            deleteEventsMultiEditorBtn.textContent = typeof t === 'function' ? t('deleteEvents.multiEditorBtnLoading') : 'æ˜¾ç¤ºä¸­...';
            
            try {
                // æå–æ‰€æœ‰å¯¹è±¡ID
                const objectIds = deleteEventsResults
                    .map(r => r.guid || r.id)
                    .filter(id => id && typeof id === 'string');
                
                if (objectIds.length === 0) {
                    alert(typeof t === 'function' ? t('deleteEvents.multiEditorNoObjects') : 'æ²¡æœ‰æœ‰æ•ˆçš„å¯¹è±¡ID');
                    return;
                }
                
                // æ˜¾ç¤ºåˆ°Multi Editor
                const result = await ipcRenderer.invoke('waapi-show-multi-editor', port, objectIds);
                
                if (result.success) {
                    // æˆåŠŸæç¤ºï¼ˆå¯é€‰ï¼‰
                } else {
                    alert((typeof t === 'function' ? t('deleteEvents.multiEditorFailed') : 'æ˜¾ç¤ºåˆ°Multi Editorå¤±è´¥') + ': ' + result.message);
                }
            } catch (error) {
                alert((typeof t === 'function' ? t('deleteEvents.multiEditorFailed') : 'æ˜¾ç¤ºåˆ°Multi Editorå¤±è´¥') + ': ' + error.message);
            } finally {
                deleteEventsMultiEditorBtn.disabled = false;
                deleteEventsMultiEditorBtn.textContent = typeof t === 'function' ? t('deleteEvents.multiEditorBtn') : 'æ˜¾ç¤ºåˆ°Multi Editor';
            }
        });

        function updateDeleteEventsTable() {
            const countText = typeof t === 'function' ? t('deleteEvents.resultsCount') : 'ä¸ªEvent';
            deleteEventsCount.textContent = `${deleteEventsResults.length} ${countText}`;
            deleteEventsClearBtn.disabled = deleteEventsResults.length === 0;
            if (deleteEventsResults.length > 0) {
                deleteEventsListViewBtn.style.display = 'inline-block';
                deleteEventsMultiEditorBtn.style.display = 'inline-block';
            } else {
                deleteEventsListViewBtn.style.display = 'none';
                deleteEventsMultiEditorBtn.style.display = 'none';
            }
            if (deleteEventsResults.length === 0) {
                const emptyText = typeof t === 'function' ? t('deleteEvents.emptyState') : 'è¯·ç‚¹å‡»"æ‰«ææ— æ•ˆEvent"æŒ‰é’®';
                deleteEventsBody.innerHTML = `<tr><td colspan="5" class="empty-state">${emptyText}</td></tr>`;
                return;
            }
            deleteEventsBody.innerHTML = deleteEventsResults.map((item, index) => `
                <tr>
                    <td><button class="btn-locate" onclick="locateObject('${item.guid}')" title="å®šä½"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg></button></td>
                    <td>${index + 1}</td>
                    <td>${item.name || 'N/A'}</td>
                    <td>${item.reason || (typeof t === 'function' ? t('deleteEvents.defaultReason') : 'æ‰€æœ‰Actionéƒ½å¼•ç”¨ä¸å­˜åœ¨çš„å¯¹è±¡')}</td>
                    <td style="font-family: monospace; font-size: 12px;">${item.path || item.guid || 'N/A'}</td>
                </tr>
            `).join('');
        }

        // è®¾ç½®æµæ’­æ”¾åŠŸèƒ½
        let setStreamingResults = [];
        const setStreamingScanBtn = document.getElementById('setStreamingScanBtn');
        const setStreamingConfirmBtn = document.getElementById('setStreamingConfirmBtn');
        const setStreamingClearBtn = document.getElementById('setStreamingClearBtn');
        const setStreamingListViewBtn = document.getElementById('setStreamingListViewBtn');
        const setStreamingBody = document.getElementById('setStreamingBody');
        const setStreamingCount = document.getElementById('setStreamingCount');
        const streamingThreshold = document.getElementById('streamingThreshold');

        setStreamingScanBtn.addEventListener('click', async () => {
            if (!isConnected) {
                alert(typeof t === 'function' ? t('setStreaming.alertNotConnected') : 'è¯·å…ˆè¿æ¥åˆ°Wwise');
                return;
            }
            const port = parseInt(portInput.value) || 8080;
            const threshold = parseFloat(streamingThreshold.value) || 10;
            
            setStreamingScanBtn.disabled = true;
            setStreamingScanBtn.textContent = typeof t === 'function' ? t('setStreaming.scanBtnScanning') : 'æ£€æµ‹ä¸­...';
            
            try {
                const result = await ipcRenderer.invoke('waapi-set-streaming-scan', port, threshold);
                setStreamingResults = result.results || [];
                updateSetStreamingTable();
                
                // æ˜¾ç¤ºæ£€æµ‹ç»“æœæç¤º
                const countText = typeof t === 'function' ? t('setStreaming.resultsCount') : 'ä¸ªå¯¹è±¡';
                if (setStreamingResults.length > 0) {
                    alert((typeof t === 'function' ? t('setStreaming.scanSuccess') : 'æ£€æµ‹å®Œæˆ') + `ï¼šæ‰¾åˆ° ${setStreamingResults.length} ${countText}`);
                    setStreamingConfirmBtn.style.display = 'inline-block';
                } else {
                    alert(typeof t === 'function' ? t('setStreaming.scanNoResults') : 'æ£€æµ‹å®Œæˆï¼šæœªæ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„å¯¹è±¡');
                }
            } catch (error) {
                alert((typeof t === 'function' ? t('setStreaming.alertScanFailed') : 'æ£€æµ‹å¤±è´¥') + ': ' + error.message);
            } finally {
                setStreamingScanBtn.disabled = false;
                setStreamingScanBtn.textContent = typeof t === 'function' ? t('setStreaming.scanBtn') : 'æ£€æµ‹é€‰ä¸­å®¹å™¨';
            }
        });

        setStreamingConfirmBtn.addEventListener('click', async () => {
            if (setStreamingResults.length === 0) return;
            
            const confirmed = await ipcRenderer.invoke('waapi-show-confirm', {
                type: 'info',
                title: typeof t === 'function' ? t('setStreaming.confirmTitle') : 'ç¡®è®¤è®¾ç½®',
                message: typeof t === 'function' ? t('setStreaming.confirmMessage', { count: setStreamingResults.length }) : `ç¡®å®šè¦ä¸º ${setStreamingResults.length} ä¸ªå¯¹è±¡è®¾ç½®æµæ’­æ”¾å—ï¼Ÿ`,
                buttons: typeof t === 'function' ? [t('common.cancel'), t('setStreaming.confirmBtn')] : ['å–æ¶ˆ', 'ç¡®è®¤è®¾ç½®'],
                defaultId: 1
            });
            
            if (confirmed.response === 1) {
                const port = parseInt(portInput.value) || 8080;
                const threshold = parseFloat(streamingThreshold.value) || 10;
                
                setStreamingConfirmBtn.disabled = true;
                setStreamingConfirmBtn.textContent = typeof t === 'function' ? t('setStreaming.confirmBtnSetting') : 'è®¾ç½®ä¸­...';
                
                try {
                    const result = await ipcRenderer.invoke('waapi-set-streaming-execute', port, threshold, setStreamingResults);
                    if (result.success) {
                        alert(typeof t === 'function' ? t('setStreaming.successMessage', { count: result.count }) : `æˆåŠŸä¸º ${result.count} ä¸ªå¯¹è±¡è®¾ç½®æµæ’­æ”¾`);
                        setStreamingResults = [];
                        updateSetStreamingTable();
                        setStreamingConfirmBtn.style.display = 'none';
                    } else {
                        alert((typeof t === 'function' ? t('setStreaming.alertSetFailed') : 'è®¾ç½®å¤±è´¥') + ': ' + result.message);
                    }
                } catch (error) {
                    alert((typeof t === 'function' ? t('setStreaming.alertSetFailed') : 'è®¾ç½®å¤±è´¥') + ': ' + error.message);
                } finally {
                    setStreamingConfirmBtn.disabled = false;
                    setStreamingConfirmBtn.textContent = typeof t === 'function' ? t('setStreaming.confirmBtn') : 'ç¡®è®¤è®¾ç½®';
                }
            }
        });

        setStreamingClearBtn.addEventListener('click', () => {
            setStreamingResults = [];
            updateSetStreamingTable();
            setStreamingConfirmBtn.style.display = 'none';
        });

        setStreamingListViewBtn.addEventListener('click', async () => {
            if (setStreamingResults.length === 0) return;
            if (!isConnected) {
                alert(typeof t === 'function' ? t('setStreaming.alertNotConnected') : 'è¯·å…ˆè¿æ¥åˆ°Wwise');
                return;
            }
            
            const port = parseInt(portInput.value) || 8080;
            setStreamingListViewBtn.disabled = true;
            setStreamingListViewBtn.textContent = typeof t === 'function' ? t('setStreaming.listViewBtnLoading') : 'æ˜¾ç¤ºä¸­...';
            
            try {
                // æå–æ‰€æœ‰å¯¹è±¡ID
                const objectIds = setStreamingResults
                    .map(r => r.id || r.guid)
                    .filter(id => id && typeof id === 'string');
                
                if (objectIds.length === 0) {
                    alert(typeof t === 'function' ? t('setStreaming.listViewNoObjects') : 'æ²¡æœ‰æœ‰æ•ˆçš„å¯¹è±¡ID');
                    return;
                }
                
                // æ˜¾ç¤ºåˆ°List View
                const result = await ipcRenderer.invoke('waapi-show-list-view', port, objectIds);
                
                if (result.success) {
                    // æˆåŠŸæç¤ºï¼ˆå¯é€‰ï¼‰
                } else {
                    alert((typeof t === 'function' ? t('setStreaming.listViewFailed') : 'æ˜¾ç¤ºåˆ°List Viewå¤±è´¥') + ': ' + result.message);
                }
            } catch (error) {
                alert((typeof t === 'function' ? t('setStreaming.listViewFailed') : 'æ˜¾ç¤ºåˆ°List Viewå¤±è´¥') + ': ' + error.message);
            } finally {
                setStreamingListViewBtn.disabled = false;
                setStreamingListViewBtn.textContent = typeof t === 'function' ? t('setStreaming.listViewBtn') : 'æ˜¾ç¤ºåˆ°List View';
            }
        });

        const setStreamingMultiEditorBtn = document.getElementById('setStreamingMultiEditorBtn');
        setStreamingMultiEditorBtn.addEventListener('click', async () => {
            if (setStreamingResults.length === 0) return;
            if (!isConnected) {
                alert(typeof t === 'function' ? t('setStreaming.alertNotConnected') : 'è¯·å…ˆè¿æ¥åˆ°Wwise');
                return;
            }
            
            const port = parseInt(portInput.value) || 8080;
            setStreamingMultiEditorBtn.disabled = true;
            setStreamingMultiEditorBtn.textContent = typeof t === 'function' ? t('setStreaming.multiEditorBtnLoading') : 'æ˜¾ç¤ºä¸­...';
            
            try {
                // æå–æ‰€æœ‰å¯¹è±¡ID
                const objectIds = setStreamingResults
                    .map(r => r.id || r.guid)
                    .filter(id => id && typeof id === 'string');
                
                if (objectIds.length === 0) {
                    alert(typeof t === 'function' ? t('setStreaming.multiEditorNoObjects') : 'æ²¡æœ‰æœ‰æ•ˆçš„å¯¹è±¡ID');
                    return;
                }
                
                // æ˜¾ç¤ºåˆ°Multi Editor
                const result = await ipcRenderer.invoke('waapi-show-multi-editor', port, objectIds);
                
                if (result.success) {
                    // æˆåŠŸæç¤ºï¼ˆå¯é€‰ï¼‰
                } else {
                    alert((typeof t === 'function' ? t('setStreaming.multiEditorFailed') : 'æ˜¾ç¤ºåˆ°Multi Editorå¤±è´¥') + ': ' + result.message);
                }
            } catch (error) {
                alert((typeof t === 'function' ? t('setStreaming.multiEditorFailed') : 'æ˜¾ç¤ºåˆ°Multi Editorå¤±è´¥') + ': ' + error.message);
            } finally {
                setStreamingMultiEditorBtn.disabled = false;
                setStreamingMultiEditorBtn.textContent = typeof t === 'function' ? t('setStreaming.multiEditorBtn') : 'æ˜¾ç¤ºåˆ°Multi Editor';
            }
        });

        function updateSetStreamingTable() {
            const countText = typeof t === 'function' ? t('setStreaming.resultsCount') : 'ä¸ªå¯¹è±¡';
            setStreamingCount.textContent = `${setStreamingResults.length} ${countText}`;
            setStreamingClearBtn.disabled = setStreamingResults.length === 0;
            if (setStreamingResults.length > 0) {
                setStreamingListViewBtn.style.display = 'inline-block';
                setStreamingMultiEditorBtn.style.display = 'inline-block';
            } else {
                setStreamingListViewBtn.style.display = 'none';
                setStreamingMultiEditorBtn.style.display = 'none';
            }
            if (setStreamingResults.length === 0) {
                const emptyText = typeof t === 'function' ? t('setStreaming.emptyState') : 'è¯·ç‚¹å‡»"æ£€æµ‹é€‰ä¸­å®¹å™¨"æŒ‰é’®';
                setStreamingBody.innerHTML = `<tr><td colspan="6" class="empty-state" id="setStreamingEmptyState">${emptyText}</td></tr>`;
                return;
            }
            setStreamingBody.innerHTML = setStreamingResults.map((item, index) => `
                <tr>
                    <td><button class="btn-locate" onclick="locateObject('${item.id}')" title="å®šä½"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg></button></td>
                    <td>${index + 1}</td>
                    <td>${item.name || 'N/A'}</td>
                    <td>${item.duration !== null && item.duration !== undefined ? item.duration.toFixed(2) : 'N/A'}</td>
                    <td>${item.shouldSet ? (typeof t === 'function' ? t('setStreaming.yes') : 'æ˜¯') : (typeof t === 'function' ? t('setStreaming.no') : 'å¦')}</td>
                    <td>${item.currentStreaming ? (typeof t === 'function' ? t('setStreaming.enabled') : 'å·²å¯ç”¨') : (typeof t === 'function' ? t('setStreaming.disabled') : 'æœªå¯ç”¨')}</td>
                </tr>

                `).join('');
        }

        // åˆ é™¤æœªä½¿ç”¨WAVåŠŸèƒ½
        let removeWavsResults = [];
        let originalsPath = '';
        const selectOriginalsBtn = document.getElementById('selectOriginalsBtn');
        const originalsPathDisplay = document.getElementById('originalsPath');
        const removeWavsScanBtn = document.getElementById('removeWavsScanBtn');
        const removeWavsConfirmBtn = document.getElementById('removeWavsConfirmBtn');
        const removeWavsClearBtn = document.getElementById('removeWavsClearBtn');
        const removeWavsBody = document.getElementById('removeWavsBody');
        const removeWavsCount = document.getElementById('removeWavsCount');

        selectOriginalsBtn.addEventListener('click', async () => {
            const result = await ipcRenderer.invoke('waapi-select-folder');
            if (!result.canceled && result.filePaths && result.filePaths.length > 0) {
                originalsPath = result.filePaths[0];
                originalsPathDisplay.textContent = originalsPath;
            }
        });

        removeWavsScanBtn.addEventListener('click', async () => {
            if (!isConnected) {
                alert(typeof t === 'function' ? t('removeWavs.alertNotConnected') : 'è¯·å…ˆè¿æ¥åˆ°Wwise');
                return;
            }
            if (!originalsPath) {
                alert(typeof t === 'function' ? t('removeWavs.alertNoPath') : 'è¯·å…ˆé€‰æ‹©Originalsæ–‡ä»¶å¤¹');
                return;
            }
            const port = parseInt(portInput.value) || 8080;
            
            removeWavsScanBtn.disabled = true;
            removeWavsScanBtn.textContent = typeof t === 'function' ? t('removeWavs.scanBtnScanning') : 'æ‰«æä¸­...';
            
            try {
                const result = await ipcRenderer.invoke('waapi-remove-wavs-scan', port, originalsPath);
                removeWavsResults = result.results || [];
                updateRemoveWavsTable();
                if (removeWavsResults.length > 0) {
                    removeWavsConfirmBtn.style.display = 'inline-block';
                }
            } catch (error) {
                alert((typeof t === 'function' ? t('removeWavs.alertScanFailed') : 'æ‰«æå¤±è´¥') + ': ' + error.message);
            } finally {
                removeWavsScanBtn.disabled = false;
                removeWavsScanBtn.textContent = typeof t === 'function' ? t('removeWavs.scanBtn') : 'æ‰«ææœªä½¿ç”¨æ–‡ä»¶';
            }
        });

        removeWavsConfirmBtn.addEventListener('click', async () => {
            if (removeWavsResults.length === 0) return;
            
            const totalSize = removeWavsResults.reduce((sum, item) => sum + (item.size || 0), 0);
            const sizeMB = (totalSize / 1024 / 1024).toFixed(2);
            
            const confirmed = await ipcRenderer.invoke('waapi-show-confirm', {
                type: 'warning',
                title: typeof t === 'function' ? t('removeWavs.confirmTitle') : 'ç¡®è®¤åˆ é™¤',
                message: typeof t === 'function' ? t('removeWavs.confirmMessage', { count: removeWavsResults.length, size: sizeMB }) : `ç¡®å®šè¦åˆ é™¤ ${removeWavsResults.length} ä¸ªæœªä½¿ç”¨çš„WAVæ–‡ä»¶å—ï¼Ÿ\næ€»å¤§å°: ${sizeMB} MB\næ­¤æ“ä½œä¸å¯æ’¤é”€ï¼`,
                buttons: typeof t === 'function' ? [t('common.cancel'), t('removeWavs.confirmBtn')] : ['å–æ¶ˆ', 'ç¡®è®¤åˆ é™¤'],
                defaultId: 1
            });
            
            if (confirmed.response === 1) {
                removeWavsConfirmBtn.disabled = true;
                removeWavsConfirmBtn.textContent = typeof t === 'function' ? t('removeWavs.confirmBtnDeleting') : 'åˆ é™¤ä¸­...';
                
                try {
                    const result = await ipcRenderer.invoke('waapi-remove-wavs-execute', removeWavsResults);
                    if (result.success) {
                        alert(typeof t === 'function' ? t('removeWavs.successMessage', { count: result.count }) : `æˆåŠŸåˆ é™¤ ${result.count} ä¸ªæ–‡ä»¶`);
                        removeWavsResults = [];
                        updateRemoveWavsTable();
                        removeWavsConfirmBtn.style.display = 'none';
                    } else {
                        alert((typeof t === 'function' ? t('removeWavs.alertDeleteFailed') : 'åˆ é™¤å¤±è´¥') + ': ' + result.message);
                    }
                } catch (error) {
                    alert((typeof t === 'function' ? t('removeWavs.alertDeleteFailed') : 'åˆ é™¤å¤±è´¥') + ': ' + error.message);
                } finally {
                    removeWavsConfirmBtn.disabled = false;
                    removeWavsConfirmBtn.textContent = typeof t === 'function' ? t('removeWavs.confirmBtn') : 'ç¡®è®¤åˆ é™¤';
                }
            }
        });

        removeWavsClearBtn.addEventListener('click', () => {
            removeWavsResults = [];
            updateRemoveWavsTable();
            removeWavsConfirmBtn.style.display = 'none';
        });

        function updateRemoveWavsTable() {
            const countText = typeof t === 'function' ? t('removeWavs.resultsCount') : 'ä¸ªæ–‡ä»¶';
            removeWavsCount.textContent = `${removeWavsResults.length} ${countText}`;
            removeWavsClearBtn.disabled = removeWavsResults.length === 0;
            if (removeWavsResults.length === 0) {
                const emptyText = typeof t === 'function' ? t('removeWavs.emptyState') : 'è¯·ç‚¹å‡»"æ‰«ææœªä½¿ç”¨æ–‡ä»¶"æŒ‰é’®';
                removeWavsBody.innerHTML = `<tr><td colspan="4" class="empty-state" id="removeWavsEmptyState">${emptyText}</td></tr>`;
                return;
            }
            removeWavsBody.innerHTML = removeWavsResults.map((item, index) => {
                const sizeKB = ((item.size || 0) / 1024).toFixed(2);
                const date = item.mtime ? new Date(item.mtime).toLocaleString('zh-CN') : 'N/A';
                return `
                    <tr>
                        <td>${index + 1}</td>
                        <td style="font-family: monospace; font-size: 12px;">${item.path || 'N/A'}</td>
                        <td>${sizeKB} KB</td>
                        <td>${date}</td>
                    </tr>
                `;
            }).join('');
        }

        // è‡ªåŠ¨è·å–Originalsè·¯å¾„
        (async () => {
            if (isConnected) {
                const port = parseInt(portInput.value) || 8080;
                try {
                    const result = await ipcRenderer.invoke('waapi-get-originals-path', port);
                    if (result.success && result.path) {
                        originalsPath = result.path;
                        originalsPathDisplay.textContent = originalsPath;
                    }
                } catch (error) {
                    // å¿½ç•¥é”™è¯¯ï¼Œç”¨æˆ·å¯ä»¥æ‰‹åŠ¨é€‰æ‹©
                }
            }
        })();
    </script>
</body>
</html>

